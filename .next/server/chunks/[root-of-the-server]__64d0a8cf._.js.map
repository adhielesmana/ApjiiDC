{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/wilayah/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport axios from \"axios\";\n\nconst BASE_URL = \"https://sipedas.pertanian.go.id/api/wilayah\";\nconst DEFAULT_YEAR = \"2025\"; // Using default year 2025 as per example\n\n// Helper function to handle API requests\nasync function fetchFromSipedas(\n  endpoint: string,\n  params: Record<string, string>\n) {\n  try {\n    const url = `${BASE_URL}/${endpoint}`;\n    const response = await axios.get(url, { params });\n    return response.data;\n  } catch (error: any) {\n    console.error(\n      `Error fetching from Sipedas API (${endpoint}):`,\n      error.message\n    );\n    throw error;\n  }\n}\n\n// Transform object response to array format\nfunction objectToArray(\n  data: Record<string, string>,\n  endpoint: string,\n  type: string\n) {\n  if (!data || typeof data !== \"object\") {\n    console.warn(\"API returned invalid data format:\", data);\n    return [];\n  }\n\n  return Object.entries(data).map(([id, name]) => {\n    switch (true) {\n      case /provinces|list_pro/.test(String(id)):\n        return { id_provinsi: id, nama_provinsi: name };\n      case /regencies|list_kab/.test(String(id)):\n        return { id_kabupaten: id, nama_kabupaten: name };\n      case /districts|list_kec/.test(String(id)):\n        return { id_kecamatan: id, nama_kecamatan: name };\n      case /villages|list_des/.test(String(id)):\n        return { id_kelurahan: id, nama_kelurahan: name };\n      default:\n        switch (true) {\n          case endpoint === \"list_pro\" || type === \"provinces\":\n            return { id_provinsi: id, nama_provinsi: name };\n          case endpoint === \"list_kab\" || type === \"regencies\":\n            return { id_kabupaten: id, nama_kabupaten: name };\n          case endpoint === \"list_kec\" || type === \"districts\":\n            return { id_kecamatan: id, nama_kecamatan: name };\n          case endpoint === \"list_des\" || type === \"villages\":\n            return { id_kelurahan: id, nama_kelurahan: name };\n          default:\n            return { id, name };\n        }\n    }\n  });\n}\n\nexport async function GET(req: NextRequest) {\n  const searchParams = req.nextUrl.searchParams;\n  const type = searchParams.get(\"type\");\n  const year = searchParams.get(\"year\") || DEFAULT_YEAR;\n\n  try {\n    let data;\n    let endpoint = \"\";\n\n    switch (type) {\n      case \"provinces\":\n        endpoint = \"list_pro\";\n        data = await fetchFromSipedas(endpoint, { thn: year });\n\n        // Transform object response to array format for provinces\n        if (!Array.isArray(data)) {\n          console.log(\"Converting provinces object to array:\", data);\n          // Format: { \"11\": \"ACEH\", \"12\": \"SUMATERA UTARA\", ... }\n          const transformedData = Object.entries(data).map(([id, name]) => ({\n            id_provinsi: id,\n            nama_provinsi: name,\n          }));\n          data = transformedData;\n        }\n        break;\n\n      case \"regencies\":\n        endpoint = \"list_kab\";\n        const provinceCode = searchParams.get(\"provinceCode\");\n        if (!provinceCode) {\n          return NextResponse.json(\n            { error: \"Province code is required\" },\n            { status: 400 }\n          );\n        }\n        data = await fetchFromSipedas(endpoint, {\n          thn: year,\n          lvl: \"11\", // Province level\n          pro: provinceCode,\n        });\n\n        // Transform object response to array format for regencies\n        if (!Array.isArray(data)) {\n          console.log(\"Converting regencies object to array:\", data);\n          const transformedData = Object.entries(data).map(([id, name]) => ({\n            id_kabupaten: id,\n            nama_kabupaten: name,\n          }));\n          data = transformedData;\n        }\n        break;\n\n      case \"districts\":\n        endpoint = \"list_kec\";\n        const regencyProvinceCode = searchParams.get(\"provinceCode\");\n        const regencyCode = searchParams.get(\"regencyCode\");\n        if (!regencyProvinceCode || !regencyCode) {\n          return NextResponse.json(\n            { error: \"Province code and regency code are required\" },\n            { status: 400 }\n          );\n        }\n        data = await fetchFromSipedas(endpoint, {\n          thn: year,\n          lvl: \"12\", // Regency level\n          pro: regencyProvinceCode,\n          kab: regencyCode,\n        });\n\n        // Transform object response to array format for districts\n        if (!Array.isArray(data)) {\n          console.log(\"Converting districts object to array:\", data);\n          const transformedData = Object.entries(data).map(([id, name]) => ({\n            id_kecamatan: id,\n            nama_kecamatan: name,\n          }));\n          data = transformedData;\n        }\n        break;\n\n      case \"villages\":\n        endpoint = \"list_des\";\n        const districtProvinceCode = searchParams.get(\"provinceCode\");\n        const districtRegencyCode = searchParams.get(\"regencyCode\");\n        const districtCode = searchParams.get(\"districtCode\");\n        if (!districtProvinceCode || !districtRegencyCode || !districtCode) {\n          return NextResponse.json(\n            { error: \"Province, regency and district codes are required\" },\n            { status: 400 }\n          );\n        }\n        data = await fetchFromSipedas(endpoint, {\n          thn: year,\n          lvl: \"13\", // District level\n          pro: districtProvinceCode,\n          kab: districtRegencyCode,\n          kec: districtCode,\n        });\n\n        // Transform object response to array format for villages\n        if (!Array.isArray(data)) {\n          console.log(\"Converting villages object to array:\", data);\n          const transformedData = Object.entries(data).map(([id, name]) => ({\n            id_kelurahan: id,\n            nama_kelurahan: name,\n          }));\n          data = transformedData;\n        }\n        break;\n\n      default:\n        return NextResponse.json(\n          {\n            error:\n              \"Invalid type. Use 'provinces', 'regencies', 'districts', or 'villages'\",\n          },\n          { status: 400 }\n        );\n    }\n\n    return NextResponse.json(data);\n  } catch (error: any) {\n    console.error(\"API error details:\", error);\n    return NextResponse.json(\n      { error: error.message || \"Failed to fetch data\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}