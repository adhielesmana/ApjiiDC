{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["// middleware.ts\nimport { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\n\nexport function middleware(request: NextRequest) {\n  const token = request.cookies.get(\"token\");\n  const userCookie = request.cookies.get(\"user\");\n\n  const isAuthPage = request.nextUrl.pathname === \"/login\";\n  const isAdminRoute = request.nextUrl.pathname.startsWith(\"/admin\");\n  const isProviderRoute = request.nextUrl.pathname.startsWith(\"/provider\");\n  const isOrderRoute = request.nextUrl.pathname.startsWith(\"/customer/orders\");\n  const isBecomeProviderRoute =\n    request.nextUrl.pathname === \"/customer/become-provider\";\n\n  try {\n    const user = userCookie ? JSON.parse(userCookie.value) : null;\n    const roleType = user?.roleType;\n\n    // Already logged in users can be redirected from login page\n    if (isAuthPage && token) {\n      return NextResponse.redirect(new URL(\"/customer\", request.url));\n    }\n\n    // Protected routes require authentication\n    if (\n      !token &&\n      (isAdminRoute || isProviderRoute || isOrderRoute || isBecomeProviderRoute)\n    ) {\n      // Create login URL with 'from' parameter to enable redirect after login\n      const loginUrl = new URL(\"/login\", request.url);\n      loginUrl.searchParams.set(\n        \"from\",\n        request.nextUrl.pathname + request.nextUrl.search\n      );\n      return NextResponse.redirect(loginUrl);\n    }\n\n    // Role-based access control (only if user is logged in)\n    if (token && roleType) {\n      // Admin routes - only admin\n      if (isAdminRoute && roleType !== \"admin\") {\n        return NextResponse.redirect(new URL(\"/customer\", request.url));\n      }\n\n      // Provider routes - only provider and admin\n      if (isProviderRoute && ![\"admin\", \"provider\"].includes(roleType)) {\n        return NextResponse.redirect(new URL(\"/customer\", request.url));\n      }\n\n      // Become provider route - only users who are not providers yet\n      if (isBecomeProviderRoute && roleType !== \"user\") {\n        return NextResponse.redirect(new URL(\"/customer\", request.url));\n      }\n    }\n\n    return NextResponse.next();\n  } catch (error) {\n    // Handle parsing errors by redirecting to login only for protected routes\n    if (\n      isAdminRoute ||\n      isProviderRoute ||\n      isOrderRoute ||\n      isBecomeProviderRoute\n    ) {\n      return NextResponse.redirect(new URL(\"/login\", request.url));\n    }\n    return NextResponse.next();\n  }\n}\n\nexport const config = {\n  matcher: [\n    \"/login\",\n    \"/admin/:path*\",\n    \"/provider/:path*\",\n    \"/customer/orders/:path*\",\n    \"/customer/become-provider\",\n  ],\n};\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;AAChB;AAAA;;AAGO,SAAS,WAAW,OAAoB;IAC7C,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC;IAClC,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEvC,MAAM,aAAa,QAAQ,OAAO,CAAC,QAAQ,KAAK;IAChD,MAAM,eAAe,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IACzD,MAAM,kBAAkB,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAC5D,MAAM,eAAe,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IACzD,MAAM,wBACJ,QAAQ,OAAO,CAAC,QAAQ,KAAK;IAE/B,IAAI;QACF,MAAM,OAAO,aAAa,KAAK,KAAK,CAAC,WAAW,KAAK,IAAI;QACzD,MAAM,WAAW,MAAM;QAEvB,4DAA4D;QAC5D,IAAI,cAAc,OAAO;YACvB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,aAAa,QAAQ,GAAG;QAC/D;QAEA,0CAA0C;QAC1C,IACE,CAAC,SACD,CAAC,gBAAgB,mBAAmB,gBAAgB,qBAAqB,GACzE;YACA,wEAAwE;YACxE,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC9C,SAAS,YAAY,CAAC,GAAG,CACvB,QACA,QAAQ,OAAO,CAAC,QAAQ,GAAG,QAAQ,OAAO,CAAC,MAAM;YAEnD,OAAO,gMAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,wDAAwD;QACxD,IAAI,SAAS,UAAU;YACrB,4BAA4B;YAC5B,IAAI,gBAAgB,aAAa,SAAS;gBACxC,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,aAAa,QAAQ,GAAG;YAC/D;YAEA,4CAA4C;YAC5C,IAAI,mBAAmB,CAAC;gBAAC;gBAAS;aAAW,CAAC,QAAQ,CAAC,WAAW;gBAChE,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,aAAa,QAAQ,GAAG;YAC/D;YAEA,+DAA+D;YAC/D,IAAI,yBAAyB,aAAa,QAAQ;gBAChD,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,aAAa,QAAQ,GAAG;YAC/D;QACF;QAEA,OAAO,gMAAY,CAAC,IAAI;IAC1B,EAAE,OAAO,OAAO;QACd,0EAA0E;QAC1E,IACE,gBACA,mBACA,gBACA,uBACA;YACA,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;QACA;QACA;QACA;QACA;KACD;AACH"}}]
}