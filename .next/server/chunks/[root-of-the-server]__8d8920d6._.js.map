{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/admin/user-management/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport axios from \"axios\";\nimport { cookies } from \"next/headers\";\n\nexport async function GET(request: Request) {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get(\"token\");\n    const BACKEND_URL = process.env.NEXT_PUBLIC_BACKEND_URL;\n\n    if (!token?.value) {\n      return NextResponse.json(\n        { status: \"error\", message: \"Unauthorized\" },\n        { status: 401 }\n      );\n    }    // Get URL parameters\n    const { searchParams } = new URL(request.url);\n    const roleType = searchParams.get(\"roleType\");\n    const role = searchParams.get(\"role\");\n    // Add includeProviderStatus parameter to get provider status with user data\n    const includeProviderStatus = true;\n      \n    // Construct query parameters if they exist\n    const queryParams = new URLSearchParams();\n    if (roleType) queryParams.append(\"roleType\", roleType);\n    if (role) queryParams.append(\"role\", role);\n    queryParams.append(\"includeProviderStatus\", includeProviderStatus.toString());\n    \n    const queryString = queryParams.toString();\n    const endpoint = `${BACKEND_URL}/admin/user${queryString ? `?${queryString}` : \"\"}`;const response = await axios.get(endpoint, {\n      headers: {\n        Authorization: token.value.startsWith(\"Bearer \")\n          ? token.value\n          : `Bearer ${token.value}`,\n      },\n    });    // Check if we have users with provider roles that need status information\n    if (response.data.status === \"ok\" && response.data.data) {\n      // Get all provider admin users with provider IDs\n      const providerAdminUsers = response.data.data.filter(\n        (user: any) => user.roleType === \"provider\" && user.role === \"admin\" && user.provider\n      );\n      \n      // If we have provider admin users, fetch all provider statuses in one request\n      if (providerAdminUsers.length > 0) {\n        try {\n          // Get all provider IDs\n          const providerIds = providerAdminUsers.map((user: any) => user.provider);\n          \n          // Fetch all providers in a single request (if API supports this)\n          const providersResponse = await axios.get(`${BACKEND_URL}/catalogue/provider`, {\n            params: {\n              ids: providerIds.join(','), // Many APIs support comma-separated IDs\n              // If your API doesn't support this, you might need to use another approach\n              limit: providerIds.length, // Get enough results to include all providers\n            },\n            headers: {\n              Authorization: token.value.startsWith(\"Bearer \")\n                ? token.value\n                : `Bearer ${token.value}`,\n            },\n          });\n          \n          if (providersResponse.data.status === \"ok\" && providersResponse.data.data) {\n            // Create a map of provider IDs to their status\n            const providerStatusMap = new Map();\n            providersResponse.data.data.forEach((provider: any) => {\n              providerStatusMap.set(provider._id, provider._isActive ? \"active\" : \"inactive\");\n            });\n            \n            // Update each user with their provider's status\n            response.data.data = response.data.data.map((user: any) => {\n              if (user.provider && providerStatusMap.has(user.provider)) {\n                return {\n                  ...user,\n                  providerStatus: providerStatusMap.get(user.provider)\n                };\n              }\n              return user;\n            });\n          }\n        } catch (error) {\n          console.error(\"Error fetching provider statuses:\", error);\n        }\n      }\n    }\n\n    return NextResponse.json(response.data);} catch (error: any) {\n    return NextResponse.json(\n      { \n        status: \"error\", \n        message: error.response?.data?.message || \"Failed to fetch users\" \n      },\n      { status: error.response?.status || 500 }\n    );\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}