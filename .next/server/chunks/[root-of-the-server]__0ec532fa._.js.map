{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/auth/login/route.ts"],"sourcesContent":["// app/api/login/route.ts\nimport { NextResponse } from \"next/server\";\nimport { cookies } from \"next/headers\";\nimport axios from \"axios\";\n\nexport async function POST(req: Request) {\n  const { usernameOrEmail, password, remember } = await req.json();\n  const BACKEND_URL = process.env.NEXT_PUBLIC_BACKEND_URL;\n\n  if (!BACKEND_URL) {\n    return NextResponse.json(\n      { success: false, message: \"Backend URL tidak ditemukan\" },\n      { status: 500 }\n    );\n  }\n\n  try {\n    console.log(\"Sending login request to:\", `${BACKEND_URL}/auth/login`);\n    console.log(\"Request payload:\", {\n      usernameOrEmail: usernameOrEmail?.trim(),\n      password: \"***\",\n      remember,\n    });\n\n    const backendRes = await axios.post(\n      `${BACKEND_URL}/auth/login`,\n      {\n        usernameOrEmail: usernameOrEmail.trim(),\n        password: password.trim(),\n        remember: Boolean(remember), // Ensure boolean type\n      },\n      {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Accept: \"application/json\",\n          \"User-Agent\": \"MitraDC-Frontend\",\n        },\n        timeout: 10000,\n        withCredentials: true,\n      }\n    );\n\n    const { token, user } = backendRes.data;\n\n    // Create response first\n    const response = NextResponse.json({\n      success: true,\n      message: \"Login berhasil\",\n      token,\n      user,\n    });\n\n    // Set cookie expiration time based on remember option\n    const cookieExpires =\n      remember === \"true\"\n        ? new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30 days if remember is true\n        : undefined; // Session cookie if remember is false\n\n    // Set cookies with proper configuration\n    response.cookies.set({\n      name: \"token\",\n      value: token,\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      path: \"/\",\n      expires: cookieExpires,\n    });\n\n    response.cookies.set({\n      name: \"user\",\n      value: JSON.stringify(user),\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      path: \"/\",\n      expires: cookieExpires,\n    });\n\n    return response;\n  } catch (error: any) {\n    const statusCode = error.response?.status || 500;\n    const errorMessage =\n      error.response?.data?.message || \"A server error occurred\";\n    const errorData = error.response?.data;\n\n    // Log detailed error for debugging\n    console.error(\"Backend login error details:\", {\n      status: statusCode,\n      message: errorMessage,\n      data: errorData,\n      headers: error.config?.headers,\n    });\n\n    // Handle 403 Forbidden\n    if (statusCode === 403) {\n      return NextResponse.json(\n        {\n          success: false,\n          message:\n            \"Access denied. Please check CORS configuration or backend authentication.\",\n        },\n        { status: 403 }\n      );\n    }\n\n    if (error.response?.status === 400) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: \"Invalid username/email or password\",\n        },\n        { status: 400 }\n      );\n    }\n\n    // Handle 401 specifically\n    if (statusCode === 401) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: \"Incorrect username/email or password\",\n        },\n        { status: 401 }\n      );\n    }\n\n    return NextResponse.json(\n      {\n        success: false,\n        message: errorMessage,\n      },\n      { status: statusCode }\n    );\n  }\n}\n"],"names":[],"mappings":"AAAA,yBAAyB;;;;;AACzB;AAEA;;;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,EAAE,eAAe,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;IAC9D,MAAM;IAEN;;IAOA,IAAI;QACF,QAAQ,GAAG,CAAC,6BAA6B,GAAG,YAAY,WAAW,CAAC;QACpE,QAAQ,GAAG,CAAC,oBAAoB;YAC9B,iBAAiB,iBAAiB;YAClC,UAAU;YACV;QACF;QAEA,MAAM,aAAa,MAAM,kJAAK,CAAC,IAAI,CACjC,GAAG,YAAY,WAAW,CAAC,EAC3B;YACE,iBAAiB,gBAAgB,IAAI;YACrC,UAAU,SAAS,IAAI;YACvB,UAAU,QAAQ;QACpB,GACA;YACE,SAAS;gBACP,gBAAgB;gBAChB,QAAQ;gBACR,cAAc;YAChB;YACA,SAAS;YACT,iBAAiB;QACnB;QAGF,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,WAAW,IAAI;QAEvC,wBAAwB;QACxB,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;YACjC,SAAS;YACT,SAAS;YACT;YACA;QACF;QAEA,sDAAsD;QACtD,MAAM,gBACJ,aAAa,SACT,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM,8BAA8B;WAC9E,WAAW,sCAAsC;QAEvD,wCAAwC;QACxC,SAAS,OAAO,CAAC,GAAG,CAAC;YACnB,MAAM;YACN,OAAO;YACP,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,MAAM;YACN,SAAS;QACX;QAEA,SAAS,OAAO,CAAC,GAAG,CAAC;YACnB,MAAM;YACN,OAAO,KAAK,SAAS,CAAC;YACtB,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,MAAM;YACN,SAAS;QACX;QAEA,OAAO;IACT,EAAE,OAAO,OAAY;QACnB,MAAM,aAAa,MAAM,QAAQ,EAAE,UAAU;QAC7C,MAAM,eACJ,MAAM,QAAQ,EAAE,MAAM,WAAW;QACnC,MAAM,YAAY,MAAM,QAAQ,EAAE;QAElC,mCAAmC;QACnC,QAAQ,KAAK,CAAC,gCAAgC;YAC5C,QAAQ;YACR,SAAS;YACT,MAAM;YACN,SAAS,MAAM,MAAM,EAAE;QACzB;QAEA,uBAAuB;QACvB,IAAI,eAAe,KAAK;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,SACE;YACJ,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,MAAM,QAAQ,EAAE,WAAW,KAAK;YAClC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,SAAS;YACX,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,0BAA0B;QAC1B,IAAI,eAAe,KAAK;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,SAAS;YACX,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,SAAS;QACX,GACA;YAAE,QAAQ;QAAW;IAEzB;AACF","debugId":null}}]
}